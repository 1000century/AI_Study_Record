# Medical Agent

LangChainì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•œ ì˜í•™ ì§„ë‹¨ ë° ì¹˜ë£Œ ì¶”ì²œ ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤. êµ¬ì¡°í™”ëœ ë„êµ¬ë“¤ì„ í™œìš©í•˜ì—¬ ì˜ë£Œì§„ì˜ ì§„ë‹¨ ê³¼ì •ì„ ì§€ì›í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Input    â”‚â”€â”€â”€â–¶â”‚  LangChain      â”‚â”€â”€â”€â–¶â”‚   Tool Calling  â”‚
â”‚  (Case Study)   â”‚    â”‚   Agent         â”‚    â”‚   Functions     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Response      â”‚
                       â”‚  Generation     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ (Tools)

| Tool ëª… | ê¸°ëŠ¥ | ì£¼ìš” ì…ë ¥ íŒŒë¼ë¯¸í„° | ì¶œë ¥ |
|---------|------|-------------------|------|
| `check_nephrotic_syndrome_criteria` | ì‹ ì¦í›„êµ° ì§„ë‹¨ ê¸°ì¤€ ì¶©ì¡± ì—¬ë¶€ í™•ì¸ | `proteinuria_g_per_day`, `albumin_g_dl`, `edema` | ì‹ ì¦í›„êµ° ì§„ë‹¨ ì—¬ë¶€ ë° ì¶©ì¡± ê¸°ì¤€ |
| `suggest_nephrotic_syndrome_cause` | ì„ìƒ ì •ë³´ ê¸°ë°˜ ì›ì¸ ê°ë³„ | `age`, `diabetes`, `pla2r_positive`, `hematuria`, `known_cancer`, `response_to_steroid` | ê°€ëŠ¥í•œ ì›ì¸ ì§ˆí™˜ (MCD, FSGS, MGN, DMN ë“±) |
| `recommend_nephrotic_syndrome_treatment` | ì§„ë‹¨ë³„ ì¹˜ë£Œ ë°©ë²• ì¶”ì²œ | `diagnosis` (MCD, FSGS, MGN, DMN, Amyloidosis) | ì§ˆí™˜ë³„ êµ¬ì²´ì  ì¹˜ë£Œ ë°©ì¹¨ |
| `summarize_nephrotic_syndrome_case` | í™˜ì ì¼€ì´ìŠ¤ ì¢…í•© ìš”ì•½ | `age`, `sex`, `proteinuria_g_day`, `albumin_g_dl`, `edema`, `hematuria` | í™˜ì ìƒíƒœ ì¢…í•© ìš”ì•½ |

### ğŸ“‹ ì§„ë‹¨ ê¸°ì¤€ ë° ê°ë³„ ì§ˆí™˜

**ì‹ ì¦í›„êµ° ì§„ë‹¨ ê¸°ì¤€:**
- ë‹¨ë°±ë‡¨ > 3.5 g/day
- ì €ì•Œë¶€ë¯¼í˜ˆì¦ < 2.5 g/dL
- ë¶€ì¢… ì¡´ì¬

**ì£¼ìš” ê°ë³„ ì§ˆí™˜:**
- **MCD (ë¯¸ì„¸ë³€í™”ë³‘)**: ì†Œì•„ì—ì„œ ê°€ì¥ í”í•¨, Steroid ë°˜ì‘ì„± ì¢‹ìŒ
- **FSGS (êµ­ì†Œë¶„ì ˆì„± ì‚¬êµ¬ì²´ê²½í™”ì¦)**: Steroid ì €í•­ì„±, ì˜ˆí›„ ë¶ˆëŸ‰
- **MGN (ë§‰ì‹ ì¥ë³‘)**: PLA2R ì–‘ì„± ì‹œ ì¼ì°¨ì„±, ì„±ì¸ ë‚¨ì„±ì—ì„œ í”í•¨
- **DMN (ë‹¹ë‡¨ë³‘ì„± ì‹ ì¥ë³‘ì¦)**: ë‹¹ë‡¨ë³‘ ë³‘ë ¥, í˜ˆë‡¨ ì—†ìŒ
- **Amyloidosis**: ALí˜•(í˜ˆì•¡ì•”), AAí˜•(ë§Œì„±ì—¼ì¦)

## ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ë¶„ì„

### Case 1: 21ì„¸ ë‚¨ì„± í™˜ì
![ì‚¬ë¡€ 1](assets/case1.svg)

**ì‹¤í–‰ëœ í•¨ìˆ˜ ìˆœì„œ:**
1. `check_nephrotic_syndrome_criteria` â†’ "ì‹ ì¦í›„êµ° ì˜ì‹¬ë©ë‹ˆë‹¤"
2. `suggest_nephrotic_syndrome_cause` â†’ "ì‹ ì¥ìƒê²€ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
3. `summarize_nephrotic_syndrome_case` â†’ "21ì„¸ ë‚¨ì„± í™˜ì, ì‹ ì¦í›„êµ° ìˆ˜ì¤€ì˜ ë‹¨ë°±ë‡¨"

### Case 2: 4ì„¸ ë‚¨ì•„ í™˜ì
![ì‚¬ë¡€2](assets/case2.svg)

**ì‹¤í–‰ëœ í•¨ìˆ˜ ìˆœì„œ:**
1. `summarize_nephrotic_syndrome_case` â†’ "4ì„¸ ë‚¨ì„± í™˜ì, ì €ì•Œë¶€ë¯¼í˜ˆì¦, ë¶€ì¢… ë™ë°˜"
2. `suggest_nephrotic_syndrome_cause` â†’ "ì†Œì•„ ì‹ ì¦í›„êµ°ìœ¼ë¡œ ë¯¸ì„¸ë³€í™”ë³‘(MCD) ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤"
3. `recommend_nephrotic_syndrome_treatment` â†’ "Steroidê°€ 1ì°¨ ì¹˜ë£Œì…ë‹ˆë‹¤"

## ğŸ”„ Agent ì›Œí¬í”Œë¡œìš°

```mermaid
graph TD
    A[í™˜ì ì¼€ì´ìŠ¤ ì…ë ¥] --> B{ë‚˜ì´ í™•ì¸}
    B -->|ì†Œì•„| C[MCD ìš°ì„  ê³ ë ¤]
    B -->|ì„±ì¸| D[ë‹¤ì–‘í•œ ì›ì¸ ê²€í† ]
    
    C --> E[Steroid ì¹˜ë£Œ ê¶Œê³ ]
    D --> F{ì¶”ê°€ ì •ë³´ í•„ìš”}
    F -->|ì¶©ë¶„í•œ ì •ë³´| G[ì›ì¸ë³„ ì¹˜ë£Œ ê¶Œê³ ]
    F -->|ë¶ˆì¶©ë¶„í•œ ì •ë³´| H[ì‹ ì¥ìƒê²€ ê¶Œê³ ]
    
    E --> I[ì¹˜ë£Œ ëª¨ë‹ˆí„°ë§]
    G --> I
    H --> J[ì¶”ê°€ ê²€ì‚¬ í›„ ì¬í‰ê°€]
```

## ğŸ¯ ì£¼ìš” íŠ¹ì§•

- **êµ¬ì¡°í™”ëœ ì…ë ¥**: Pydantic ëª¨ë¸ì„ ì‚¬ìš©í•œ íƒ€ì… ì•ˆì „ì„± ë³´ì¥
- **ì˜ë£Œ ê°€ì´ë“œë¼ì¸ ê¸°ë°˜**: ì‹¤ì œ ì‹ ì¦í›„êµ° ì§„ë‹¨ ë° ì¹˜ë£Œ ê¸°ì¤€ ë°˜ì˜
- **ì—°ë ¹ë³„ ì ‘ê·¼**: ì†Œì•„ì™€ ì„±ì¸ì˜ ë‹¤ë¥¸ ì ‘ê·¼ ë°©ì‹ ì ìš©
- **ë‹¨ê³„ë³„ ì˜ì‚¬ê²°ì •**: ì²´ê³„ì ì¸ ì§„ë‹¨ í”„ë¡œì„¸ìŠ¤

## ğŸš€ ì‚¬ìš© ë°©ë²•

```python
# Agent ì´ˆê¸°í™”
agent = create_tool_calling_agent(llm=llm, tools=all_tools, prompt=prompt)
agent_executor = AgentExecutor(agent=agent, tools=all_tools, verbose=True)

# ì¼€ì´ìŠ¤ ì‹¤í–‰
result = agent_executor.invoke({"input": "í™˜ì ì¼€ì´ìŠ¤ ì„¤ëª…..."})
print(result['output'])
```

## ğŸ“ˆ ì‹¤í–‰ ê²°ê³¼ ìƒì„¸ ë¶„ì„

### Case 1: 21ì„¸ ë‚¨ì„± í™˜ì
| ë‹¨ê³„ | í˜¸ì¶œëœ Tool | ì…ë ¥ ë°ì´í„° | ì¶œë ¥ ê²°ê³¼ |
|------|-------------|-------------|----------|
| 1 | `check_nephrotic_syndrome_criteria` | proteinuria: 10.2g/day<br>albumin: 2.7g/dL<br>edema: True | "ì‹ ì¦í›„êµ° ì˜ì‹¬ë©ë‹ˆë‹¤: ë‹¨ë°±ë‡¨ > 3.5 g/day, ë¶€ì¢…" |
| 2 | `suggest_nephrotic_syndrome_cause` | age: 21<br>diabetes: False<br>hematuria: False<br>response_to_steroid: unknown | "ì‹ ì¦í›„êµ°ì˜ ì›ì¸ì„ ëª…í™•íˆ íŒë‹¨í•˜ê¸° ì–´ë ¤ìš°ë©°, ì‹ ì¥ìƒê²€ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" |
| 3 | `summarize_nephrotic_syndrome_case` | age: 21, sex: male<br>proteinuria: 10.2g/day<br>albumin: 2.7g/dL<br>edema: True, hematuria: False | "21ì„¸ ë‚¨ì„± í™˜ìì…ë‹ˆë‹¤. ì‹ ì¦í›„êµ° ìˆ˜ì¤€ì˜ ë‹¨ë°±ë‡¨, ë¶€ì¢… ë™ë°˜" |

### Case 2: 4ì„¸ ë‚¨ì•„ í™˜ì  
| ë‹¨ê³„ | í˜¸ì¶œëœ Tool | ì…ë ¥ ë°ì´í„° | ì¶œë ¥ ê²°ê³¼ |
|------|-------------|-------------|----------|
| 1 | `summarize_nephrotic_syndrome_case` | age: 4, sex: male<br>proteinuria: 3.2g/day<br>albumin: 2.3g/dL<br>edema: True, hematuria: False | "4ì„¸ ë‚¨ì„± í™˜ìì…ë‹ˆë‹¤. ì €ì•Œë¶€ë¯¼í˜ˆì¦, ë¶€ì¢… ë™ë°˜" |
| 2 | `suggest_nephrotic_syndrome_cause` | age: 4<br>diabetes: False<br>hematuria: False<br>response_to_steroid: unknown | "ì†Œì•„ ì‹ ì¦í›„êµ°ìœ¼ë¡œ ë¯¸ì„¸ë³€í™”ë³‘(MCD) ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤" |
| 3 | `recommend_nephrotic_syndrome_treatment` | diagnosis: MCD | "Steroidê°€ 1ì°¨ ì¹˜ë£Œì…ë‹ˆë‹¤. ë°˜ì‘ ì—†ìœ¼ë©´ ìƒê²€ í›„ ë©´ì—­ì–µì œì œ ê³ ë ¤" |

### ì‹¤í–‰ íŒ¨í„´ ë¶„ì„
| í•­ëª© | Case 1 (21ì„¸) | Case 2 (4ì„¸) |
|------|---------------|--------------|
| ì´ í˜¸ì¶œ í•¨ìˆ˜ ìˆ˜ | 3ê°œ | 3ê°œ |
| ì²« ë²ˆì§¸ í˜¸ì¶œ | ì§„ë‹¨ ê¸°ì¤€ í™•ì¸ | ì¼€ì´ìŠ¤ ìš”ì•½ |
| ë‘ ë²ˆì§¸ í˜¸ì¶œ | ì›ì¸ ë¶„ì„ | ì›ì¸ ë¶„ì„ |
| ì„¸ ë²ˆì§¸ í˜¸ì¶œ | ì¼€ì´ìŠ¤ ìš”ì•½ | ì¹˜ë£Œ ê¶Œê³  |
| ìµœì¢… ê²°ë¡  | ì‹ ì¥ìƒê²€ í•„ìš” | MCD â†’ Steroid ì¹˜ë£Œ |
| Agent íŒë‹¨ ê·¼ê±° | ì„±ì¸, ì›ì¸ ë¶ˆëª…í™• | ì†Œì•„ < 12ì„¸ â†’ MCD |

---

*ì´ ì—ì´ì „íŠ¸ëŠ” ì˜ë£Œì§„ì˜ ì§„ë‹¨ ë³´ì¡° ë„êµ¬ë¡œ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, ì‹¤ì œ ì„ìƒ ê²°ì •ì€ ì „ë¬¸ì˜ì˜ íŒë‹¨ì„ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.*